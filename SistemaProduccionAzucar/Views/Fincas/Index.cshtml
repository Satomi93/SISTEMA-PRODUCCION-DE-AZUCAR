@model SistemaProduccionAzucar.Models.TableViewModels.FincasViewModel

@{
    ViewBag.Title = "Administración de Fincas";
}


<body>

    <!------------------------------------------------------------
    --------------
    VENTANAS DE ADMINISTRACION DE FINCAS
    ---------------
    --------------------------------------------------------->
    <!---- BOTON PARA AGREGAR FINCA----->
    <div>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#agregarFinca">
            Agregar Fincas
        </button>
    </div>

    <!-- AGREGAR FINCAS -->
    <div class="modal fade" id="agregarFinca" tabindex="-1" aria-labelledby="exampleModalLiveLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLiveLabel">Agregar Finca</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <br />
                <div class="modal-body">
                    <form id="form-agregar-fincas">
                        <div class="form-group">
                            <label for="nombre">Nombre:</label>
                            <input type="text" class="form-control" name="nombre" id="nombre" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="direccion">Dirección:</label>
                            <input type="text" class="form-control" name="direccion" id="direccion" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="area">Área:</label>
                            <input type="number" class="form-control" name="area" id="area" placeholder="">
                        </div>
                        <div id="msj-infoFinca" class="alert alert-info d-none" role="alert"></div>
                        <div class="row">
                            <!-- /.col -->
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-block mb-3">Guardar</button>
                            </div>
                            <!-- /.col -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- MOSTRAR TABLAS FINCAS -->
    <br /><br />
    <div class="container mb-5 mt-3">
        <table id="finca" class="table table-striped table-bordered" style="width: 90%">
            <tr>
                <th class="col-1">
                    Cod
                </th>
                <th class="col-3">
                    Nombre
                </th>
                <th class="col-3">
                    Direccion
                </th>
                <th class="col-4">
                    Accion
                </th>
            </tr>

            @foreach (var fincas in Model.tablaFincas)
            {
                <tr>
                    <td>@fincas.cod_finca</td>
                    <td> @fincas.nombre</td>
                    <td>@fincas.direccion</td>
                    <td>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#registroSembrado" onclick="mostrarSembrados(@fincas.cod_finca)">SEMBRADO</button>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#registroCorte" onclick="mostrarCortes(@fincas.cod_finca)">CORTE</button>
                    </td>
                </tr>

            }
        </table>
        <span id="codigo" hidden></span>

    </div>

    <div class="modal fade" id="registroSembrado" tabindex="-1" aria-labelledby="modal-history" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLiveLabel">Registro de siembra</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>

                </div>
                <div class="modal-body">
                    <div>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#agregarSembrado">Agregar siembra</button>
                    </div>
                    <div id="tabla-registro-sembrado" class="table-responsive mailbox-messages">
                        <table class="table table-hover table-striped">
                            <thead>
                                <tr>
                                    <th class="col-1"> Codigo</th>
                                    <th class="col-3"> Cantidad Sembrada</th>
                                    <th class="col-1"> unidad</th>
                                    <th class="col-3"> Cantidad fertilizante </th>
                                    <th class="col-1"> unidad</th>
                                    <th class="col-3"> Fecha</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- AGREGAR REGISTROS A SEMBRADO -->
    <div class="modal fade" id="agregarSembrado" tabindex="-1" aria-labelledby="exampleModalLiveLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLiveLabel">Agregar siembra</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <br />
                <div class="modal-body">
                    <form id="form-agregar-sembrado">
                        <div class="form-group">
                            <label for="cantidadSembrada">Cant. sembrada:</label>
                            <input type="number" class="form-control" name="cantidadSembrada" id="cantidadSembrada" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="cantidadFertilizante">Cant. fertilizante:</label>
                            <input type="number" class="form-control" name="cantidadFertilizante" id="cantidadFertilizante" placeholder="">
                        </div>
                        <div id="msj-infoSembrado" class="alert alert-info d-none" role="alert"></div>
                        <div class="row">
                            <!-- /.col -->
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-block mb-3">Guardar</button>
                            </div>
                            <!-- /.col -->
                        </div>
                    </form>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!------------------------------------------------------------
        --------------
        VENTANAS DE ADMINISTRACION DE CORTES
        ---------------
        --------------------------------------------------------->

    <div class="modal fade" id="registroCorte" tabindex="-1" aria-labelledby="exampleModalLiveLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLiveLabel">Registro de cortes</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <br />
                <div class="modal-body">
                    <div>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#agregarCorte">Agregar corte</button>
                    </div>
                    <div id="tabla-registro-corte" class="table-responsive mailbox-messages">
                        <table class="table table-striped table-bordered" style="width: 90%">
                            <thead>
                                <tr>
                                    <th class="col-1">
                                        Codigo
                                    </th>
                                    <th class="col-3">
                                        Cantidad Cortada
                                    </th>
                                    <th class="col-1">
                                        unidad
                                    </th>
                                    <th class="col-3">
                                        Fecha
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @*@foreach (var fincas in Model.tabla_registro_corte)
                                {
                                    <tr>
                                        <td>@fincas.cod_corte</td>
                                        <td> @fincas.cantidad_cortada</td>
                                        <td>@fincas.unidad</td>
                                        <td>@fincas.fecha_registro</td>
                                    </tr>
                                }*@
                            </tbody>
                        </table>
                     </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
        </div>
    </div>

    <!-- AGREGAR REGISTROS A CORTE -->
    <div class="modal fade" id="agregarCorte" tabindex="-1" aria-labelledby="exampleModalLiveLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLiveLabel">Agregar corte</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <br />
                <div class="modal-body">
                    <form id="form-agregar-corte">
                        <div class="form-group">
                            <label for="cantidadCortada">Cant. Cortada:</label>
                            <input type="number" class="form-control" name="cantidadCortada" id="cantidadCortada" placeholder="">
                        </div>
                        <div id="msj-infoCorte" class="alert alert-info d-none" role="alert"></div>
                        <div class="row">
                            <!-- /.col -->
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-block mb-3">Guardar</button>
                            </div>
                            <!-- /.col -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</body>
@section Scripts {
    <script type="text/javascript">

        var fincaS = 0;

        function mostrarSembrados(id) {

            fincaS = id;

        $.post('@Url.Content("~/Fincas/Sembrado")',
        {
            codFinca: id
        },
        (data) => {
            if (data.response == 1) {
                $('#tabla-registro-sembrado > table > tbody').html('');



                $.each(data.data, function (i, item) {
                    let row = '<tr>';
                    row += '   <td>' + item.cod_sembrado + '</td>';
                    row += '   <td>' + item.cantidad_sembrado + '</td>';
                    row += '   <td>' + item.unidad_sembrado + '</td>';
                    row += '   <td>' + item.cantidad_fertilizante + '</td>';
                    row += '   <td>' + item.unidad_fertilizante + '</td>';
                    row += '   <td>' + item.fecha_registroStr + '</td>';
                    row += '</tr>';

                    $("#tabla-registro-sembrado > table > tbody").append(row);
                });
            }
        });
        }



        function mostrarCortes(id) {


        $.post('@Url.Content("~/Fincas/Cortes")',
        {
            codFinca: id
        },
        (data) => {
            if (data.response == 1) {
                $('#tabla-registro-corte > table > tbody').html('');



                $.each(data.data, function (i, item) {
                    let row = '<tr>';
                    row += '   <td>' + item.cod_corte + '</td>';
                    row += '   <td>' + item.cantidad_cortada + '</td>';
                    row += '   <td>' + item.unidad+ '</td>';
                    row += '   <td>' + item.fecha_registroStr + '</td>';
                    row += '</tr>';

                    $("#tabla-registro-corte > table > tbody").append(row);
                });
            }
        });
        }

    $(document).ready(() => {
        // VALIDACION DE FORMULARIO AGREGAR FINCA

        $("#form-agregar-fincas").validate({
            rules: {
                nombre: {
                    required: true
                },
                direccion: {
                    required: true
                },
                area: {
                    required: true
                },
            },
            messages: {
                nombre: {
                    required: "Ingrese nombres de finca"
                },
                direccion: {
                    required: "Ingrese dirección de finca."
                },
                area: {
                    required: "Ingrese área de finca."
                },
            },
            onchange: true,
            errorClass: "error-validation",
            errorElement: "p",
            errorPlacement: function (error, element) {
                element.parent().append(error);
            }
        });

        $('#form-agregar-fincas').submit((e) => {
            e.preventDefault();
            let values = $('#form-agregar-fincas').serialize();

            if ($('#form-agregar-fincas').valid()) {
                $('#msj-info').addClass('d-none');

                $.post('@Url.Content("~/Fincas/AgregarFinca")', values, (data) => {
                    if (data.response == 1) {
                        window.location.reload(true);
                    } else if (data.response == 0) {
                        $('#msj-info').text(data.message).removeClass('d-none');
                    }
                });
            }
        });
    });

    $(document).ready(() => {
        // VALIDACION DE FORMULARIO AGREGAR SEMBRADO

        $("#form-agregar-sembrado").validate({
            rules: {
                cantidadSembrada: {
                    required: true
                },
                cantidadFertilizante: {
                    required: true
                },
            },
            messages: {
                cantidadSembrada: {
                    required: "Ingrese cantidad"
                },
                cantidadFertilizante: {
                    required: "Ingrese cantidad."
                },
            },
            onchange: true,
            errorClass: "error-validation",
            errorElement: "p",
            errorPlacement: function (error, element) {
                element.parent().append(error);
            }
        });

        $('#form-agregar-sembrado').submit((e) => {
            e.preventDefault();
            let values = $('#form-agregar-sembrado').serialize();

            if ($('#form-agregar-sembrado').valid()) {
                $('#msj-info').addClass('d-none');

                $.post('@Url.Content("~/Fincas/AgregarSembrado")',values, (data) => {
                    if (data.response == 1) {
                        console.log(data.message);
                        window.location.reload(true);
                    } else if (data.response == 0) {
                        $('#msj-infoSembrado').text(data.message).removeClass('d-none');
                    }
                });
            }
        });
    });

    $(document).ready(() => {
        // VALIDACION DE FORMULARIO AGREGAR CORTE

        $("#form-agregar-corte").validate({
            rules: {
                cantidadCortada: {
                    required: true
                },
            },
            messages: {
                cantidadCortada: {
                    required: "Ingrese cantidad"
                },
            },
            onchange: true,
            errorClass: "error-validation",
            errorElement: "p",
            errorPlacement: function (error, element) {
                element.parent().append(error);
            }
        });

        $('#form-agregar-corte').submit((e) => {
            e.preventDefault();
            let values = $('#form-agregar-corte').serialize();

            if ($('#form-agregar-corte').valid()) {
                $('#msj-info').addClass('d-none');

                $.post('@Url.Content("~/Fincas/AgregarCorte")',values, (data) => {
                    if (data.response == 1) {
                        console.log(data.message);
                        window.location.reload(true);
                    } else if (data.response == 0) {
                        $('#msj-infoCorte').text(data.message).removeClass('d-none');
                    }
                });
            }
        });
    });
    </script>
}